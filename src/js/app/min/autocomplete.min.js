window.m=window.m||{},define(["jquery","carousel","knockout","knockoututils","json2.min","bootstrap","jqueryfinger","owlcarousel","mobilebase"],function(t,e,i){function o(){var t=this;try{t.autocomplete=(new m.AutoComplete).init({list:"#list_autoComplete",panel:"#panel_autoComplete",search:"#form_autoComplete",input:"#form_topSearch input[name='stx']",cookieKey:"autoComplete"}),t.lastsearch=(new m.LastSearch).init({list:"#list_lastSearch",panel:"#panel_lastSearchList"}),t.autocomplete.shown(function(){t.lastsearch.hide()}),t.lastsearch.shown(function(){t.autocomplete.hide()})}catch(e){console.log("오류있다능 조심하라능"),console.log(e)}console.log("자동완성 객체 로딩 끗")}o.prototype=new m.BaseViewModel,o.prototype.constructor=o,m.AutoCompleteModel=o,m.LastSearch=function(){this.expireHour=168,this.max=0,this.list=i.observableArray(),this.used=i.observable(!0)},m.LastSearch.prototype={init:function(e){var i={max:5,list:null,panel:null,cookieKey:"lastSearch",name:"최근 검색어"};return t.extend(i,e),this.checkRequireOption(i,this._getRequireOptionNames()),this.option=i,this.max=this.option.max,this.jqList=t(this.option.list),this.jqPanel=t(this.option.panel),this.jqHeading=this.jqPanel.find(".panel-heading"),this.jqUsedButton=this.jqPanel.find(".last-search-used"),this.jqCloseButton=this.jqPanel.find(".close"),this.used(this.getUsed()),this.initEvent(),this.load(),this},checkRequireOption:function(t,e){for(var i=e.length,o="",n=void 0,s=0;i>s;s++)if(o=e[s],n=t[o],null===n||void 0===n)throw"LastSearch.checkRequireOption: 오류: "+o+" 옵션은 필수 입니다."},_getRequireOptionNames:function(){return["list","panel"]},initEvent:function(){var t=this;this.onUseChange=function(){t.used()===!0?confirm(t.option.name+" 기능을 끄시겠습니까?")===!0&&(t.setUsed(!1),t.used(!1)):confirm(t.option.name+" 기능을 켜시겠습니까?")===!0&&(t.setUsed(!0),t.used(!0))},this.onCloseClick=function(){t.hide()},this.evt_shown=null,this.shown=function(t){return this.evt_shown=t,this},this.onShown=function(){try{this.evt_shown()}catch(t){}},this.evt_hidden=null,this.hidden=function(t){return this.evt_hidden=t,this},this.onHidden=function(){try{this.evt_hidden()}catch(t){}},this.jqUsedButton.click(this.onUseChange),this.jqCloseButton.click(this.onCloseClick)},put:function(t){var e=this.list();this.list.unshift(t),e.length>this.max&&(console.log("팝!!!!!"),this.list.pop()),this.save()},load:function(){var t=this.getLength();this.clear();for(var e=0;t>e;e++)this.list.push(decodeURI(m.cookie.get("m."+this.option.cookieKey+"."+e)))},save:function(){var t=this.list(),e=t.length;e>this.max&&(e=this.max),this.setLength(e);for(var i=0;e>i;i++)m.cookie.set("m."+this.option.cookieKey+"."+i,t[i],this.expireHour)},clear:function(){try{this.list.removeAll()}catch(t){}},removeAll:function(){var t=this.list(),e=t.length;this.setLength(0);for(var i=0;e>i;i++)m.cookie.remove("m."+this.option.cookieKey+"."+i)},showList:function(){this.jqHeading.show(),this.jqList.slideDown()},hideList:function(){this.jqHeading.hide(),this.jqList.slideUp()},show:function(){var t=this;this.used()===!0&&(this.jqHeading.show(),this.jqList.show()),this.jqPanel.show(function(){t.onShown(t)})},hide:function(){this.jqPanel.hide(),this.onHidden(this)},isVisible:function(){return"none"!==this.jqPanel.css("display")},getLength:function(){return t.tryParseInt(m.cookie.get("m."+this.option.cookieKey+".length"),0)},setLength:function(t){m.cookie.set("m."+this.option.cookieKey+".length",t,this.expireHour)},getUsed:function(){return 1===t.tryParseInt(m.cookie.get("m."+this.option.cookieKey+".used"),1)},setUsed:function(t){m.cookie.set("m."+this.option.cookieKey+".used",t?1:0,this.expireHour)}},m.AutoComplete=function(){},m.AutoComplete.prototype=new m.LastSearch,t.extend(m.AutoComplete.prototype,{constructor:m.AutoComplete,init:function(e){return m.LastSearch.prototype.init.call(this,e),this.option.name="자동완성",this.jqFormSearch=t(this.option.search),this.jqSearchText=t(this.option.input),this.jqFormSearch.submit(this.onSearchSubmit),this.jqSearchText.keyup(this.onSearchTextChange),this},initEvent:function(){m.LastSearch.prototype.initEvent.call(this);var e=this;this.onSearchSubmit=function(){var i=e.jqFormSearch,o="",n=[],s=e.max;return o=m.serializeMap(i),console.log(o),t.getJSON(i.attr("action"),o,function(i){console.log(i),i&&(i.lec_cate&&t.map(i.lec_cate,function(t){n.push(t)}),i.book_cate&&t.map(i.book_cate,function(t){n.push(t)}),n.length>s&&(n=n.slice(0,s))),e.setList(n),e.show()}),!1},this.onSearchTextChange=function(i){var o="";e._isDelay=e._isDelay||!1,e._beforeRequestText=e._beforeRequestText||"",setTimeout(function(){e._isDelay===!1?(o=t(i.currentTarget).val(),e._beforeRequestText!==o&&(console.log(i),console.log(o),e._beforeRequestText=o,e.setSearchText(o),e.jqFormSearch.submit(),e._isDelay=!0,setTimeout(function(){e._isDelay=!1,e._beforeRequest===!0&&(e.onSearchTextChange(i),e._beforeRequest=!1)},200))):e._beforeRequest=e._beforeRequest||!0},1e3)}},_getRequireOptionNames:function(){return["list","panel","search","input"]},load:function(){},setList:function(e){var i=this.list;this.clear(),e&&t.map(e,function(t){t.lec_cat_id?t.cat_id=m.findBookCateByLecCate(t.lec_cat_id).book_cate:(t.cat_id=t.book_cat_id,t.lec_cat_id=""),i.push(t)})},setSearchText:function(t){this.jqFormSearch.find("input[type='text']").val(t)}})});
window.m=window.m||{},define(["jquery","carousel","knockout","knockoututils","json2.min","bootstrap","owlcarousel","iscroll","sammy","mobilebase","navbar","order","myorder","contents","member","board","mypage","event"],function(e,a,t){function o(){var a=this;a.main={jqMain:e("#view_main"),jqAd:e("#owlca_ad"),jqBooks:e("#owlca_books"),event:new m.eventData,exam:t.observableArray(),notice:new m.bbsListData,news:new m.bbsListData,isMain:t.observable(!0),init:function(){""===m.web_param.view_type||"main"===m.web_param.view_type,a.main.jqAd.owlCarousel({autoPlay:3e3,items:1,itemsDesktop:[1199,1],itemsDesktopSmall:[979,1],itemsMobile:[479,1],itemsTablet:[768,1],afterMove:function(){}}),a.main.jqBooks.owlCarousel({autoPlay:4e3,items:6,itemsDesktop:[1199,6],itemsDesktopSmall:[980,5],itemsTablet:[768,4],itemsTabletSmall:[699,3],itemsMobile:[450,2]}),e("#owlca_books").siblings(".prev").click(function(){return a.main.jqBooks.data("owlCarousel").prev(),!1}),e("#owlca_books").siblings(".next").click(function(){return a.main.jqBooks.data("owlCarousel").next(),!1}),e(window).on("m.slidechanged",function(e,t){a.main.jqMain.get(0)===t.target?a.main.isMain(!0):a.main.isMain(!1)});try{e("#modal_popup .btn-popup-close-not-today").click(function(){m.cookie.set("popup_not_today","true",24,"m.sdedu.co.kr")}),e("*[data-close]").click(function(){e(e(this).data("close")).modal("hide")}),e("#modal_popup").get(0).addEventListener("touchmove",function(e){return e.preventDefault(),!1},!1)}catch(t){}e.getJSON("/mobile/mb/main.php",function(e){console.log(e),a.nav&&a.nav.setData(e.cate),a.main.setData(e),a.hideLoadingModal();try{"main"!==m.web_param.view_type||"main"!==m.sammy.params.view_type&&"home"!==m.sammy.params.view_type||"true"===m.cookie.get("popup_not_today")||""!==m.web_param.cat_id||a.showPopup()}catch(t){console.log("팝업 띄우기 실패")}a.main.onMainDataLoaded(e)}).fail(function(){console.log("main.php 로딩에 실피 했습니다.")}),e("#button_footerNavCloser").click(function(){var a=e(this),t=e("#button_myMenuOpener, #button_gotoTop"),o=e(".footer-float-nav-margin");return t.hasClass("down")===!1?t.animate({bottom:"-=55px"},function(){e(this).toggleClass("down"),o.css("height","0px")}):t.animate({bottom:"+=55px"},function(){e(this).toggleClass("down"),o.css("height","66px")}),a.toggleClass("bg-f-nav-close"),a.toggleClass("bg-f-nav-open"),e(this).next().slideToggle(),!1}).trigger("click")},setData:function(t){var o=a.main.jqAd.data("owlCarousel"),i="http://image.sdedu.co.kr";a.main.jqAd.empty(),e.map(t.bn,function(e){o.addItem(a.makeOwlcaItem(i+"/data/cm_shop/banner/"+e.bn_file,"#contents/lec/"+m.findBookCateByLecCate(e.lec_cat_id).book_cate+"/"+e.lec_cat_id+"/"+e.cat_name))}),o=a.main.jqBooks.data("owlCarousel"),a.main.jqBooks.empty(),e.map(t.best,function(e){var t=a.dcRate(e.it_price,e.it_sug_price);o.addItem(a.makeOwlcaItem(i+"/data/cm_shop/book/"+e.it_id+"/"+e.it_file_l,"#contents/book/"+e.it_id,"<br/><span><b>"+e.it_name+'<br/></b><br/><strong class="text-danger">&#8361;'+a.numberFormat(e.it_price)+"("+t+"%할인)</strong></span>"))}),a.main.event.set(t.event),a.main.exam.removeAll(),e.map(t.exam,function(e){a.main.exam.push(new m.examListData(e))}),a.main.notice.set(t.notice),a.main.news.set(t.news)},onBannerClick:function(t){var o=null,i=e(t.target);o="IMG"===i.prop("tagName")?i.parent():i.parentsUntil("a").parent();try{t.currentTarget=o.get(0),a.onClickBoard(a,t)}catch(t){}},evt_maindataloaded:null,maindataloaded:function(e){this.evt_maindataloaded=e},onMainDataLoaded:function(e){try{this.evt_maindataloaded(e)}catch(a){}}},a.makeOwlcaItem=function(e,a,t){return'<div class="item"><a href="'+a+'"><img alt="" src="'+e+'"/>'+(void 0!==t?t:"")+"</a></div>"},a.getViewButton=function(a){var t=null;return t="movie"===a?e("#wrap_adViewButtons").find(".btn-movie").clone():e("#wrap_adViewButtons").find(".btn-book").clone(),e("<div/>").append(t).html()},a.main.init()}function i(e,a){console.log("setMbdata---"+e);var o=new m.MVModel;o.mname=t.observable(e),o.mid=t.observable(a)}function n(){this.run=function(){if(void 0===m.NavModel||void 0===m.OrderModel||void 0===m.MyOrderModel||void 0===m.BoardModel||void 0===m.MemberModel||void 0===m.MyPageModel||void 0===m.ContentsModel)throw"some models are undefined.";if(m.binded!==!0){var a=new m.MVModel,o=new m.NavModel,i=new m.OrderModel,n=new m.MyOrderModel,r=new m.BoardModel,s=new m.MemberModel,l=new m.MyPageModel,d=new m.ContentsModel;e.extend(a,o),e.extend(a,i),e.extend(a,n),e.extend(a,r),e.extend(a,s),e.extend(a,l),e.extend(a,d),a.main.maindataloaded(function(t){if(""!==m.web_param.cat_id){var o={},i=t.cate,n=null,r=null,s=null,l=m.web_param.cat_id,d=!1,c=0,b=null;if(o.view_type="contents",o.name="all","0"===m.web_param.it_type)for(var v in i){n=i[v].sub_cat;for(var f in n){r=n[f],s=r.sub_cat,c=s.length;for(var p=0;c>p;p++)if(s[p].cat_id===l){o.bbsId=l,o.subId=m.lecCateInfo.hasOwnProperty(l)?m.lecCateInfo[l].lec_cate:"",o.keyword=s[p].cat_name,d=!0;break}}if(d===!0)break}else"1"===m.web_param.it_type&&(b=m.findBookCateByLecCate(m.web_param.cat_id),o.bbsId=b.book_cate,o.subId=b.lec_cate,o.keyword=b.name);a.doClickBoard(o),m.viewSlider.push(e("#view_main"))}}),a.contents.submitorder(function(e,t){var o=a.member.hasLogin(),t=void 0===t?!1:t;o===!0?location.href="#order/cartlist"+(t===!0?"/buy":""):(location.href="#member/login"+(t===!0?"/buy":""),m.viewSlider.push(param))}),a.contents.submitorderfree(function(e){var t=a.member.hasLogin();"YES"===e.status[0].status&&t===!0?confirm("무료수강 신청이 완료 되었습니다.\r\n마이페이지로 이동하시겠습니까?")===!0&&(location.href="#mypage/mylec"):location.href="#member/login"}),a.member.loginsuccess(function(e,t){a.order.member.mb_id(e.mb_id),"main"===t.toOtherView&&a.doClickBoard({view_type:""})}),a.member.logoutsuccess(function(){a.order.member.mb_id(""),m._cpiClicked=!1,location.href="#main"}),a.board.logincheck(function(){var e=a.member.hasLogin();return e}),a.comment.logincheck(function(){var e=a.member.hasLogin();return e===!1&&confirm("덧글을 남기기 위해서는 로그인이 필요합니다.\r\n로그인 하시겠습니까?")===!0&&(location.href="#member/login"),e}),a.memUpdate.logincheck(function(){var e=a.member.hasLogin();return e}),a.board.levelcheck(function(){var e=a.member.mb_level();return e}),a.board.authcheck(function(e,t){var o=!1;return o=void 0!==e.bbsId?a.member.mb_level()>=t.auth.detail:a.member.mb_level()>=t.auth.list,console.log(e),console.log(o),o===!0?!1:(location.href="#member/login",m.viewSlider.push(e),!0)}),a.zipcode.selected(function(e){a.order.shown()===!0&&(a.order.member.mb_zip1(e.zip1),a.order.member.mb_zip2(e.zip2),a.order.member.mb_addr1(e.addr),a.order.member.mb_addr2(""))}),a.zipcode.selected(function(e){a.memUpdate.isVisible()===!0&&(a.memUpdate.mb_zip1(e.zip1),a.memUpdate.mb_zip2(e.zip2),a.memUpdate.mb_addr1(e.addr),a.memUpdate.mb_addr2(""))});var c=function(t){if(m._cpiClicked=m._cpiClicked||!1,console.log("index.fnOnURIChange"),m._cpiClicked!==!0){if(m._cpiClicked=!0,setTimeout(function(){m._cpiClicked=!1},500),"board"!==t.view_type&&"g4_write_cs_faq"!==t.name&&e(window).scrollTop(0),"board"===t.view_type)console.log("보드!"),a.board.searchByParam(t);else if("contents"===t.view_type)a.contents.searchByParam(t);else if("member"===t.view_type)a.member.moveViewByParam(t);else if("order"===t.view_type)"mocklist"===t.name?alert("준비중 입니다."):a.member.hasLogin()===!1?(a.member.moveViewByParam({view_type:"member",name:"login"}),m.viewSlider.push(t)):"cartlist"===t.name?(a.order.load(),"buy"===t.bbsId?a.order.show(!0):a.order.show()):"booklist"===t.name?a.myBooks.show():"list"===t.name&&a.myOrder.show();else{if("nav"===t.view_type)return a.nav.showNavByParam(t),void 0;"mypage"===t.view_type?a.member.hasLogin()===!1?(a.member.moveViewByParam({view_type:"member",name:"login"}),m.viewSlider.push(t)):"mylec"===t.name?a.myLecture.showByParam(t):"coupon"===t.name?a.coupon.show():"mileage"===t.name?a.mileage.show():"regbook"===t.name&&alert("준비중 입니다."):"doc"===t.view_type?e.get("/mobile/doc/"+t.name+".php",function(a){var o=e("#view_doc");o.find("h2>span").text(t.bbsId),o.find(".article").html(a),m.viewSlider.left(o)}):"main"===t.view_type?(m._cpiClicked=!1,console.log("cpi 초기화"),m.viewSlider.left("#view_main")):(m._cpiClicked=!1,console.log("cpi 초기화"),m.viewSlider.left("#view_main"))}a.nav.hideMyMenu(),a.nav.hide()}};m.sammy.urichange(c),e("#view_lectureContent").on("m.slidechanged",function(){}),e("#view_boardList").on("m.slidechanged",function(){}),e(".view_bookDetail").on("m.slidechanged",function(){var a=e("#panel_productInfo1").find("a"),t=e("#panel_productInfo1 table").filter(function(){var a=e(this),t=e.tryParseInt(a.attr("width"));return t>400&&700>t?!0:void 0});a.parentsUntil("div").empty(),t.css({width:"100%"})}),e("#view_boardDetail").on("m.slidechanged",function(){var t=a.board.heading.type();if("event"===t){var o=e("#view_boardDetail").find(".wrap-wr-content img");console.log(o),o.css({width:"100%",height:"auto"}),m.event.init()}}),e("#view_boardDetail").on("m.sameslidefound",function(){var t=a.board.heading.type();if("event"===t){var o=e("#view_boardDetail").find(".wrap-wr-content img");console.log(o),o.css({width:"100%",height:"auto"}),m.event.init()}}),m.vm=a,e(".heading-contents").append(e('<a href="#" class="_gotoback"></a>').click(function(){m.viewSlider.prev()})),t.applyBindings(a),m.binded=!0,"main"!==m.web_param.view_type?(m.vm.doClickBoard(m.web_param),m.viewSlider.push(e("#view_main"))):""!==m.web_param.cat_id}}}o.prototype=new m.BaseViewModel,o.prototype.constructor=o,m.MVModel=o,m.setMBdata=i,m.bannerDataKeys=["bn_cnt","bn_file","bn_sort","bn_subject","bn_type","bn_url","cat_id"],m.bannerData=function(e){var a=this,o=m.bannerDataKeys.length,i=m.bannerDataKeys;if(e)for(var n=0;o>n;n++)a[i[n]]=t.observable(e[i[n]]);else for(var n=0;o>n;n++)a[i[n]]=t.observable("");a.set=function(e){if(e)for(var t=0;o>t;t++)a[i[t]](e[i[t]]);else for(var t=0;o>t;t++)a[i[t]]("")}},m.bookDataKeys=["cat_id","it_file_l","it_id","it_name","it_price","it_sug_price"],m.bookData=function(e){var a=this,o=m.bookDataKeys.length,i=m.bookDataKeys;if(e)for(var n=0;o>n;n++)a[i[n]]=t.observable(e[i[n]]);else for(var n=0;o>n;n++)a[i[n]]=t.observable("");a.set=function(e){if(e)for(var t=0;o>t;t++)a[i[t]](e[i[t]]);else for(var t=0;o>t;t++)a[i[t]]("")},a.getDcRate=function(){return 0}},m.eventDataKeys=["wr_subject","bf_file","wr_id"],m.eventData=function(e){var a=this,o=m.eventDataKeys.length,i=m.eventDataKeys;if(a.bf_file_path="/data/file/event/",e)a.wr_subject=t.observable(e.wr_subject),a.bf_file=t.observable(a.bf_file_path+e.bf_file),a.wr_id=t.observable(e.wr_id);else{for(var n=0;o>n;n++)a[i[n]]=t.observable("");a.bf_file(m.img.none)}a.set=function(e){if(e)a.wr_subject(e.wr_subject),a.bf_file(a.bf_file_path+e.bf_file),a.wr_id(e.wr_id);else{for(var t=0;o>t;t++)a[i[t]]("");a.bf_file(m.img.none)}}},m.bbsListDataKeys=["wr_subject","wr_id"],m.bbsListData=function(e){var a=this,o=m.bbsListDataKeys.length,i=m.bbsListDataKeys;if(e)for(var n=0;o>n;n++)a[i[n]]=t.observable(e[i[n]]);else for(var n=0;o>n;n++)a[i[n]]=t.observable("");a.set=function(e){if(e)for(var t=0;o>t;t++)a[i[t]](e[i[t]]);else for(var t=0;o>t;t++)a[i[t]]("")}},m.examListDataKeys=["ES_wrsdate","wr_subject","wr_id"],m.examListData=function(e){var a=this,o=m.examListDataKeys.length,i=m.examListDataKeys;if(e)for(var n="",r=0;o>r;r++)n=i[r],a[n]="ES_wrsdate"===n?t.observable(e[n].replace("-",".")):t.observable(e[n]);else for(var r=0;o>r;r++)a[i[r]]=t.observable("");a.set=function(e){var t="";if(e)for(var n=0;o>n;n++)"ES_wrsdate"===t?a[i[n]](e[i[n]].replace("-",".")):a[i[n]](e[i[n]]);else for(var n=0;o>n;n++)a[i[n]]("")}},m.App=n,e(function(e){var a=new e.App;a.run()}(window.m,e,t))});
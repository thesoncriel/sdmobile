window.m=window.m||{},define(["jquery","carousel","knockout","knockoututils","json2.min","bootstrap","jqueryfinger","owlcarousel","mobilebase"],function(t,e,a){function i(){var e=this;e.boardHeading={g4_write_cs_inquery:{name:"1:1 문의",type:"qna",loginNeed:!0,auth:{list:2,write:2,detail:2}},g4_write_cs_notice:{name:"공지사항",auth:{list:1,write:6,detail:1}},g4_write_dcc_notice:{name:"최신뉴스",auth:{list:1,write:6,detail:1}},g4_write_dcc_exam:{name:"시험공고",auth:{list:1,write:6,detail:2}},g4_write_data_gichul:{name:"기출문제",loginNeed:!0,auth:{list:1,write:6,detail:2}},g4_write_data_law:{name:"개정법령",loginNeed:!0,auth:{list:1,write:6,detail:2}},g4_write_data_err:{name:"정오표",loginNeed:!0,auth:{list:1,write:6,detail:2}},g4_write_event:{name:"이벤트",type:"event",comment:!0,auth:{list:1,write:6,detail:1}},g4_write_cs_faq:{name:"FAQ",type:"accordion",auth:{list:1,write:6,detail:1}},g4_write_dcc_sisa:{name:"상식",auth:{list:1,write:6,detail:1}}},e.board={jqForm:t("#form_searchBoardList"),jqFormDetail:t("#form_searchBoardDetail"),jqFormEdit:t("#form_boardEdit"),heading:new m.boardInfoData,isWriteMode:a.observable(!1),list:a.observableArray(),eventList:a.observableArray(),detail:a.observable(),detailFiles:a.observableArray(),detailReply:a.observable(),detailReplyFiles:a.observableArray(),hasDetailReply:a.observable(!1),caNameList:a.observableArray(),writerId:a.observable(m.mb_id),wr_id:a.observable(""),table:a.observable("g4_write_cs_notice"),totalRowCount:1,rowNumColName:"rnum",pagination:new m.Pagination,init:function(){this.jqForm.submit(function(){return e.board.search(),window.scrollTo(0,0),!1}),this.getEditMode=a.computed(function(){return e.board.isWriteMode()===!0?"n":"u"}),this.evt_logincheck=null,this.logincheck=function(t){this.evt_logincheck=t},this.onlogincheck=function(){try{return this.evt_logincheck()}catch(t){}return!1},this.evt_levelcheck=null,this.levelcheck=function(t){this.evt_levelcheck=t},this.onlevelcheck=function(){try{return this.evt_levelcheck()}catch(t){}return 0},this.hasAuthWrite=a.computed(function(){try{var t=e.board.heading.auth.write()<=e.board.onlevelcheck()&&e.board.onlogincheck();return t}catch(a){}return!1}),t("#button_boardList_write").click(this.onWriteClick),t(".button_boardEdit_writeComplete").click(this.onWriteCompleteClick),t(".button_gotoBoardList").click(this.onGoToListClick),t(".button_boardEdit_modify").click(this.onModifyClick),t(".wrap-ongoing-selector button").click(function(){t(this).parent().find("button").removeClass("btn-info").addClass("btn-default"),t(this).addClass("btn-info"),e.board.setEventOnGoing(t(this).data("ongoing")),e.board.search()})},searchByParam:function(t){return t.view_type&&"board"!==t.view_type?(console.log("잘못된 파라메터: "+t.view_type),console.log(t),void 0):(this.authCheck(t)!==!0&&(this.clearSearchText(),t.name&&(t.name!==this.getTable()&&this.list.removeAll(),this.setTable(t.name)),t.bbsId?this.searchDetail(t.bbsId):this.search()),void 0)},search:function(a){var i=this,o="",n="";void 0!==a?this.setPage(a):this.setPage(1),o=this.jqForm.serialize(),t.getJSON(this.jqForm.attr("action"),o,function(a){n=i.getTable(),console.log(a),i.totalRowCount=t.tryParseInt(a.cnt),i.heading.name(e.boardHeading[n].name),i.heading.type(e.boardHeading[n].type),i.heading.auth.list(e.boardHeading[n].auth.list),i.heading.auth.write(e.boardHeading[n].auth.write),i.heading.auth.detail(e.boardHeading[n].auth.detail),i.heading.loginNeed(e.boardHeading[n].loginNeed),delete a.totalRowCount,a.totalRowCount=i.totalRowCount,a.page=i.getPage(),a.rows=i.getRows(),i.generateRowNumber(a.board),"event"===i.heading.type()?i.setEventListData(a.board):i.setListData(a.board),i.onDataLoaded(a),i.showList()})},searchDetail:function(a,i){var o=null,n={table:i||this.getTable(),wr_id:a},r=this,l=(n.table,e.boardHeading[n.table]),s=this.heading.type();return"accordion"===s&&(o=t("tr[data-wr_id='"+a+"']"),this.hasCollapseContent(o)===!0)?(o.next().fadeToggle(),void 0):(t.getJSON(this.jqForm.attr("action"),n,function(t){console.log(t),r.wr_id(n.wr_id),r.heading.name(l.name),r.heading.type(l.type),r.heading.comment(l.comment),r.heading.auth.list(l.auth.list),r.heading.auth.write(l.auth.write),r.heading.auth.detail(l.auth.detail),r.heading.loginNeed(l.loginNeed),"accordion"===s?(e.board.makeCollapse(o,t.board[0].wr_content),o.next().fadeIn()):(r.heading.name(l.name),r.setDetailData(t.board[0]),void 0!==t.comm?r.heading.comment()!==!0?(r.setDetailReplyData(t.comm[0]),r.setDetailFiles(t.comm[0].file),r.hasDetailReply(!0),e.comment.setAllData([])):(e.comment.setAllData(t.comm),e.comment.search(),r.setDetailReplyData(null),r.hasDetailReply(!1)):(e.comment.setAllData([]),r.setDetailReplyData(null),r.hasDetailReply(!1)),e.comment.search(),r.showDetail())}),void 0)},loadCategoryNames:function(){var a={edit:"yes",table:this.getTable()};t.getJSON(this.jqForm.attr("action"),a,function(t){console.log(t);try{e.board.caNameList.removeAll()}catch(a){}t.ca_name?e.board.caNameList(t.ca_name):e.board.caNameList([])})},setListData:function(t){this.list.removeAll(),this.list(t)},setEventListData:function(t){this.eventList.removeAll(),this.eventList(t)},setDetailData:function(t){this.setDetailDataCommon(t)},setDetailReplyData:function(t){this.setDetailDataCommon(t,"reply")},setDetailDataCommon:function(t,e){var a=t?t.file:{},i=[],o=0,n=null;if(a){for(var r in a)"count"!==r&&(o=parseInt(r),n=a[r],n.href=n.href.replace("./download.php","download_mobile.php"),i[o]=n);t&&(t.file=i)}"reply"===e?this.detailReply(t):this.detail(t)},setDetailFiles:function(e,a){"reply"===a?this.detailReplyFiles.removeAll():this.detailFiles.removeAll(),void 0!==e&&t.isArray(e)===!0&&e.length>0&&("reply"===a?this.detailReplyFiles(e):this.detailFiles(e))},setCategoryName:function(t){this.caNameList(t)},generateRowNumber:function(t,e){var a=this.getRows(),i=this.getPage(),o=this.totalRowCount,n=0,r=0,l=t.length,s=this.rowNumColName;e===!0?(r=1+(i-1)*a,n=1):(r=o-(i-1)*a,n=-1);for(var c=0;l>c;c++)t[c][s]=r,r+=n},getPage:function(){return t.tryParseInt(this.jqForm.find("[name='page']").val())},setPage:function(t){this.jqForm.find("[name='page']").val(t)},getRows:function(){return t.tryParseInt(this.jqForm.find("[name='rows']").val())},setRows:function(t){this.jqForm.find("[name='rows']").val(t)},getTable:function(){return this.jqForm.find("[name='table']").val()},setTable:function(t){this.table(t),this.jqForm.find("[name='table']").val(t)},getEventOnGoing:function(){return this.jqForm.find("[name='ongoing']").val()},setEventOnGoing:function(t){this.jqForm.find("[name='ongoing']").val(t)},clearSearchText:function(){this.jqForm.find("[name='stx']").val("")},showList:function(){m.slideLeft(t(".active-view"),t("#view_boardList"))},showDetail:function(){e.comment.jqFormWrite.find("textarea[name='wr_content']").val(""),m.viewSlider.left(t("#view_boardDetail"))},hasCollapseContent:function(t){return t.next().hasClass("accordion-collapse-content")},makeCollapse:function(e,a){var i="",o=null;i=t("#template_boardType_accordion").html(),e.after(i),o=e.next(),o.find("td").css("background-color","#fff"),o.find("p").html(a).find("img").css({width:"100%",height:"auto"})},convertOngoingEvent:function(t,a){var i=new Date,o=new Date(e.dateFormat(t)),n=new Date(e.dateFormat(a)),r=o.getTime()<=i.getTime()&&i.getTime()<=n.getTime();return r===!0?"진행중":"완료"},convertAnswerComplete:function(t){return"1"===t?"답변완료":"답변중"},authCheck:function(t){var a=e.boardHeading[t.name];return a.loginNeed===!0?e.board.onAuthCheck(t,a):!1},showModify:function(){this.isWriteMode(!1),this.loadCategoryNames(),m.slideLeft(t(".active-view"),t("#view_boardEdit"))},showWrite:function(){this.isWriteMode(!0),this.loadCategoryNames(),this.setDetailData({wr_subject:"",wr_content:"",ca_name:"",wr_id:""}),m.slideLeft(t(".active-view"),t("#view_boardEdit"))},showLoading:function(){t(".wrap_modal.wrap-modal-boardEdit").show()},hideLoading:function(){t(".wrap_modal.wrap-modal-boardEdit").hide()},onItemClick:function(t){e.board.searchDetail(t.wr_id,e.board.getTable())},onWriteClick:function(){e.board.showWrite()},onWriteCompleteClick:function(){var a=t("#textbox_boardEdit_wrContentEditable"),i=t("textarea[name='wr_content']"),o=e.board.jqFormEdit,n=null,r=e.board;return r.showLoading(),i.text(a.html()),n=o.serializeArray(),t.post(o.attr("action"),n,function(t){console.log(t),r.hideLoading(),m.toast("작성 완료 되었습니다."),r.search()}),!1},onGoToListClick:function(){0===e.board.list().length?e.board.search():e.board.showList()},onModifyClick:function(){e.board.showModify()},onToggleComment:function(e,a){var i=t(a.currentTarget).parentsUntil(".comment-item").parent().eq(0),o=i.find(".comment-icon-collapse");i.find("pre").toggleClass("comment-item-collapsed"),o.toggleClass("glyphicon-chevron-down"),o.toggleClass("glyphicon-chevron-up")},evt_dataloaded:null,dataloaded:function(t){this.evt_dataloaded=t},onDataLoaded:function(t){try{this.evt_dataloaded(t)}catch(e){}},evt_readboardlist:null,readboardlist:function(t){evt_readboardlist=t},onReadBoardList:function(t){try{this.evt_readboardlist(t)}catch(e){}},evt_readboarddetail:null,readboarddetail:function(t){evt_readboarddetail=t},onReadBoardDetail:function(t,e){try{this.evt_readboarddetail(t,e)}catch(a){}},evt_authcheck:null,authcheck:function(t){this.evt_authcheck=t},onAuthCheck:function(t,e){try{return this.evt_authcheck(t,e)}catch(a){}return!1},hideWriterName:function(t){var e=t.length;return"qna"===this.heading.type()?"**"+t.substr(e-1,1):t}},e.comment={jqForm:t("#form_boardComment"),jqFormWrite:t("#form_boardCommentWrite"),list:a.observableArray(),pagination:new m.Pagination,totalRowCount:1,allData:[],init:function(){this.jqFormWrite.submit(this.onWriteCompleteClick)},search:function(t){var e=(this.jqForm.serialize(),this),a={},i=[],o=0,n=0,r=this.allData.length;void 0!==t?this.setPage(t):this.setPage(1),a.totalRowCount=r,a.page=e.getPage(),a.rows=e.getRows(),o=a.page*a.rows,n=o-a.rows;for(var l=n;o>l&&!(l>=r);l++)i.push(this.allData[l]);this.setListData(i),e.onDataLoaded(a)},setAllData:function(t){this.allData=t},setListData:function(t){try{this.list.removeAll()}catch(e){}this.list(t)},getPage:function(){return t.tryParseInt(this.jqForm.find("[name='page']").val())},setPage:function(t){this.jqForm.find("[name='page']").val(t)},getRows:function(){return t.tryParseInt(this.jqForm.find("[name='rows']").val())},setRows:function(t){this.jqForm.find("[name='rows']").val(t)},setCw:function(t){this.jqForm.find("[name='cw']").val(t)},setWrId:function(t){this.jqForm.find("[name='wr_id']").val(t)},onWriteCompleteClick:function(){var a=t(this),i=m.serializeMap(a),o=e.comment;return o.onLoginCheck()===!1?!1:""===i.wr_content?(alert("댓글 내용을 입력하여 주십시요."),!1):(t.post(a.attr("action"),i,function(e){var n=t.parseJSON(e),r=a.find("textarea[name='wr_content']"),l=null;console.log(n),"YES"===n.status[0].status&&(l=new Date,i.wr_datetime=l.getFullYear()+"-"+l.getMonth()+"-"+l.getDate()+" "+l.getHours()+":"+l.getMinutes()+":"+l.getSeconds(),r.val(""),o.allData.unshift(i),o.search(),m.toast("댓글이 작성 되었습니다."))}),!1)},evt_dataloaded:null,dataloaded:function(t){this.evt_dataloaded=t},onDataLoaded:function(t){try{this.evt_dataloaded(t)}catch(e){}},evt_logincheck:null,logincheck:function(t){this.evt_logincheck=t},onLoginCheck:function(){try{return this.evt_logincheck()}catch(t){}return!1}},e.board.init(),e.board.pagination.init(),e.board.dataloaded(function(t){e.board.pagination.generateByMap(t)}),e.board.pagination.pageclick(function(t){e.board.search(t.page)}),e.comment.init(),e.comment.pagination.init({pageClickToTop:!1}),e.comment.dataloaded(function(t){e.comment.pagination.generateByMap(t)}),e.comment.pagination.pageclick(function(t){e.comment.search(t.page)})}i.prototype=new m.BaseViewModel,i.prototype.constructor=i,m.BoardModel=i,m.boardInfoData=function(){var t=this;t.name=a.observable(),t.caNames=a.observableArray(),t.type=a.observable(),t.comment=a.observable(!1),t.auth={list:a.observable(),write:a.observable(),detail:a.observable()},t.loginNeed=a.observable(!1)},m.Pagination=function(){this.list=a.observableArray(),this.totalRowCount=1,this.rowLimit=10,this.navCount=5,this.page=a.observable(1),this.lastPage=a.observable(1),this.moveToLoad=!0,this.option=null},m.Pagination.prototype={init:function(e){var i=this;return this.option={pageClickToTop:!0},t.extend(this.option,e),this.isFirstPageGroup=a.computed(function(){var t=i.page(),e=i.navCount;return e>=t}),this.isLastPageGroup=a.computed(function(){var t=i.page(),e=i.navCount,a=i.lastPage(),o=i.navCount,n=Math.floor((t-1)/o)*o+1,r=Math.floor((a-1)/o)*o+1,l=!1;return r>a&&(r=n),console.log({page:t,rowlimit:e,lastPage:a,navCount:o,minRange:n,lastMin:r}),l=a>=t&&n===r}),this.initEvent(),this.generate(this.totalRowCount,this.rowLimit,this.navCount,this.page()),this},initEvent:function(){var e=this;this.evt_pageclick=null,this.pageclick=function(t){this.evt_pageclick=t},this.onPageClick=function(a,i){var o=parseInt(a),n=t(i.currentTarget).parent(),r=n.parent();if(o!==e.page()){r.find("li.active").removeClass("active"),n.addClass("active");try{e.evt_pageclick({page:o}),e.option.pageClickToTop===!0&&t(window).scrollTop(0,0)}catch(l){console.log(a),console.log(i)}}},this.onMovePrevClick=function(a,i){var o=t(i.currentTarget).parent(),n=0,r=0,l=0,s=0;o.hasClass("disabled")!==!0&&(l=e.navCount,r=e.page(),s=r%l,n=0===s?r-1:r-s-l+1,e.moveToLoad===!0&&(i.currentTarget=o.siblings().eq(0).find("a").get(0),e.onPageClick(n,i)),console.log(a),console.log(i))},this.onMoveNextClick=function(a,i){var o=t(i.currentTarget).parent(),n=0,r=0,l=0,s=0;o.hasClass("disabled")!==!0&&(l=e.navCount,r=e.page(),s=r%l,n=0===s?r+1:r-s+l+1,e.moveToLoad===!0&&(i.currentTarget=o.siblings().eq(1).find("a").get(0),e.onPageClick(n,i)),console.log(a),console.log(i))}},generateByMap:function(t){this.generate(t.totalRowCount,t.rows,this.navCount,t.page)},generateByPage:function(t){var e=parseInt(t);this.generate(this.totalRowCount,this.rowLimit,this.navCount,e)},generate:function(t,e,a,i){for(var o=Math.floor(t/e+(t%e>0?1:0)),n=Math.floor((i-1)/a)*a+1,r=o%a>o-i?o%a:a,l=n,s=[],c=0;r>c;++c)s[c]=l,++l;this.page(i),this.totalRowCount=t,this.rowLimit=e,this.navCount=a,this.lastPage(o),this.list(s)}}});
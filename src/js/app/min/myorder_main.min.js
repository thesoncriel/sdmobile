window.m=window.m||{},define(["jquery","carousel","knockout","knockoututils","json2.min","bootstrap","mobilebase"],function(e,t,i){function r(){var e=this;e.myBooks=new m.MyOrderController({view:"#view_myBookList",form:"#form_searchBooks"}),e.myOrder=new m.MyOrderController({view:"#view_myOrderList",form:"#form_searchOrder",lib:"receipt"}),e.myBooks.init(),e.myOrder.init()}function a(t){var r=this,a=m.MyOrderProps,s=a.length,o="";if(t){for(var n=0;s>n;n++)r[a[n]]=i.observable(t[a[n]]);o=r.img(),void 0!==o&&r.img("/"+o.replace(/\.\.\//g,""))}else for(var n=0;s>n;n++)r[a[n]]=i.observable("");r.itemTotalDiscount=i.computed(function(){var t=e.tryParseInt(r.it_cash()),i=e.tryParseInt(r.it_coupon()),a=(e.tryParseInt(r.it_cp()),e.tryParseInt(r.it_enuri()));return t+i+t+a}),r.set=function(e){for(var t=m.MyOrderProps,i=t.length,a="",s=0;i>s;s++)r[t[s]](e[t[s]]());a=r.img(),void 0!==a&&r.img("/"+a.replace(/\.\.\//g,""))}}r.prototype=new m.BaseViewModel,r.prototype.constructor=r,m.MyOrderModel=r,m.MyOrderController=function(t){var r=this,a=t.view,s=t.form;r.option=t,r.libIncluded=!1,this.searchParam={svs:"book",stab:"",s_date:"",e_date:"",page:1,rows:5},this.jqForm=e(s),this.list=i.observableArray(),this.detail=new m.MyOrder,this.cache=[],this.init=function(){var e=this.jqForm;e.submit(function(){var t={page:1,s_date:e.find("input[name='s_date']").val(),e_date:e.find("input[name='e_date']").val(),svs:"book",stab:"",rows:e.find("input[name='rows']").val()};return r.readMyOrderList(t),!1})},this.selectMonthRange=function(t,i){if(void 0!==i){var r=e(i.currentTarget),a=r.parent(),s=e("input[name='s_date']"),o=e("input[name='e_date']"),n=i.currentTarget,d=(r.prop("tagName"),e.tryParseInt(r.val())),c=new Date,l=e.formatDate(c,"-"),u=e.addDate(c,-d);n.checked===!0&&(a.siblings().removeClass("btn-primary"),a.addClass("btn-primary")),s.val(u),o.val(l)}},this.seeOrderDetail=function(e,t){void 0!==t&&r.detail.set(e)},this.show=function(){this.searchParam.page=1,this.includeLibrary(),this.load(),m.viewSlider.left(a)},this.isSameParams=function(e){var t=!0;for(var i in e)"page"!==i&&(t=t&&e[i]===this.searchParam[i]);return t},this.load=function(){this.readMyOrderList(this.searchParam)},this.includeLibrary=function(){if(this.libIncluded===!1)if(this.option.lib&&""!==this.option.lib){var e=this;require([this.option.lib],function(){e.libIncluded=!0})}else this.libIncluded===!0},this.readMyOrderList=function(t){var i=r.isSameParams(t);return i===!0&&void 0!==r.cache[t.page]?(r.setMyOrdersList(r.cache[t.page]),r.searchParam=t,void 0):(i===!1&&(r.cache=[]),r.searchParam=t,console.log(t),e.getJSON(r.jqForm.attr("action"),t,function(e){console.log(e),void 0===e||0===e.length?1===r.searchParam.page?r.setMyOrdersList([]):r.searchParam.page--:r.setMyOrdersList(e)}).fail(function(e,t,i){console.log(i),console.log(e),console.log(t),alert("에러가 발생하였습니다")}),void 0)},this.prevMyOrderList=function(e,t){return void 0!==t?(r.searchParam.page>1&&(r.searchParam.page--,r.readMyOrderList(r.searchParam)),!1):void 0},this.nextMyOrderList=function(e,t){return void 0!==t?(r.searchParam.page++,r.readMyOrderList(r.searchParam),!1):void 0},this.setMyOrdersList=function(t){r.cache[r.searchParam.page]=t,r.list.removeAll(),e.map(t,function(e){r.list.push(new m.MyOrder(e))})},this.onClickReceiptByTID_card=function(e){var t="3"===e.it_type()||"5"===e.it_type()?"sidaegosi":"sidaedu1",i=e.od_tid(),r=e.authdata();return console.log(e),window.showReceiptByTID(t,i,r),!1},this.onClickReceiptByTID_ars=function(e){var t="1011940",i=e.od_tid(),r=e.authdata();return console.log(e),window.showReceiptByTID(t,i,r),!1},this.onClickCashReceipts=function(e){var t="3"===e.it_type()||"5"===e.it_type()?"sidaegosi":"sidaedu1",i=e.od_id(),r="001",a="real"===e.od_settle_use()?"BANK":"CAS",s="service";return console.log(e),window.showCashReceipts(t,i,r,a,s),!1}},m.MyOrderProps=["authdata","ca_id","ca_qty","ca_status","ca_status2","cat_id","d_status","de_id","deliveryTraceurl","e_date","ex_price","img","it_cash","it_coupon","it_coupon_use","it_cp","it_delivery","it_delivery_use","it_enuri","it_id","it_name","it_opt","it_price","it_res_price","it_settle_price","it_type","life_e_date","life_s_date","od_b_name","od_bank_use","od_deposit_name","od_id","od_invoice","od_invoice_time","od_settle_price","od_settle_use","od_status","od_status2","od_tid","pa_ca_id","pause_cnt","pause_day","pause_state","s_date","s_status","site","stock_use","tax_use","tempOLDordergoodsID","update_datetime","update_mb_id"],m.MyOrder=a});
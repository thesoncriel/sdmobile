window.m=window.m||{},define(["jquery","carousel","knockout","knockoututils","json2.min","bootstrap","mobilebase","jqueryfinger"],function(e,t,o){function n(){var t=this,n="market://details?id=kr.imgtech.zoneplayer",a=n;t.myLecture={loginNow:!1,itemList:o.observableArray(),tbList:o.observableArray(),init:function(){return e(".phead a").addClass("collapsed"),e(".subjecttitle a").addClass("collapsed"),m.mb_id?(e("#login_error").on("hide.bs.modal",function(e){console.log(e),t.myLecture.loginNow===!1&&m.viewSlider.prev(),t.myLecture.loginNow=!1}),void 0):(e("#login_error").modal("show"),t.myLecture.showModalBackground(),!1)},setData:function(o){this.itemList.removeAll(),e.map(o,function(e){t.myLecture.itemList.push(e)}),t.myLecture.init()},setTbData:function(o){this.tbList.removeAll(),e.map(o,function(e){t.myLecture.tbList.push(e)})},load:function(){e.getJSON("/mobile/mb/mypage_lecture.php",{mb_id:m.mb_id},function(e){console.log(e),t.myLecture.setData(e),t.myLecture.loadContentData(0,0)})},loadContentData:function(o,n){console.log(o+","+n),t.showLoadingModal(),e.getJSON("/mobile/mb/tbcontentlist.php",{tb_id:o,it_id:n},function(e){console.log(e),t.myLecture.setTbData(e),t.hideLoadingModal()})},showByParam:function(e){e.bbsId?(t.myLecture.loadContentData(e.bbsId,e.subId),m.viewSlider.left("#view_lectureContentList")):this.show()},show:function(){t.myLecture.load(),m.viewSlider.left("#view_lectureContent")},show4dep:function(o,n){var a=m.parseParam(e(n.currentTarget).attr("href"));t.myLecture.loadContentData(o.tb_id,a.bbsId),m.viewSlider.left("#view_lectureContentList")},hide4dep:function(){},showMessage:function(o){event.bubbles===!0&&(t.myLecture.showModalBackground(),e("#message_layer p").remove(),e("#message_layer").append("<p>"+o+"</p>"),e("#message_layer").fadeIn(),e("#message_layer").css({"box-shadow":"5px 5px 10px #333"}))},hideMessage:function(){e("#message_layer").fadeOut(),t.myLecture.hideModalBackground(),e("#message_layer").css({"box-shadow":"none"})},showModalBackground:function(){},hideModalBackground:function(){},set_ad_app:function(){var e=confirm("Zone@Player 앱을 설치하거나\n업데이트하시면\n이용할 수 있습니다.\n설치 하시겠습니까?");e&&(location.href=a)},startZonePlayer:function(e){event.bubbles===!0&&(document.appframe.location=e,setTimeout(t.myLecture.callback(),500))},callback:function(){try{var e=document.appframe.document.body,t=document.getElementById("applinkDiv");t.innerHTML="Installed!<p>"+e}catch(o){if(confirm("앱이 설치 되어 있지 않습니다.\n\n앱을 설치하시겠습니까?\n\n이미 설치하신경우 새로고침 해주세요!"))return alert("설치후 반드시 새로고침을 해주세요."),location.href=a,!1}},executeApp:function(t){event.bubbles===!0&&e(location).attr("href",t)}},t.coupon=(new m.CouponViewController).init({form:"#form_searchCoupon",view:"#view_coupon",useDateRange:!0,colTotalRowCount:"cou_cnt",customField:["cou_total_cnt"]}),t.mileage=(new m.DefaultViewController).init({form:"#form_searchMileage",view:"#view_mileage",useDateRange:!0,colTotalRowCount:"mil_cnt",customField:["mb_cash"]})}n.prototype=new m.BaseViewModel,n.prototype.constructor=n,m.MyPageModel=n,m.DefaultViewController=function(){var e=this;e.jqForm=null,e.list=null,e.pagination=null,e.data=null,e.evt_dataloaded=[],e.dataloaded=function(e){this.evt_dataloaded.push(e)},e.onDataLoaded=function(e){try{for(var t=this.evt_dataloaded.length,o=0;t>o;o++)this.evt_dataloaded[o](e)}catch(n){}},e.evt_shown=[],e.shown=function(e){this.evt_shown.push(e)},e.onShown=function(e){try{for(var t=this.evt_shown.length,o=0;t>o;o++)this.evt_shown[o](e)}catch(n){}}},m.DefaultViewController.prototype={init:function(t){var n=this,a={form:"#form",view:"#view",useDateRange:!1,colTotalRowCount:"totalRowCount",colList:"list",usePagenation:!0,pageClickToTop:!1,customField:[],useEndDatePlus:!0};return e.extend(a,t),n.option=a,n.jqForm=e(n.option.form),n.jqView=e(n.option.view),n.list=o.observableArray(),n.onSubmitSearch=function(){return n.search(),!1},n.jqForm.submit(n.onSubmitSearch),n.jqView.on("m.slidechanged",function(e,t){n.onShown(t)}),n.option.useDateRange===!0&&n.initDateRange(),n.option.usePagenation===!0&&n.initPagenation(),n.option.customField.length>0&&n.initCustomField(),this},initDateRange:function(){var t=this,o=t.jqForm,n=o.find("*[data-role='dateRangeSelector']");n.find("button[data-range]").click(function(){var o=e.tryParseInt(e(this).data("range")),n=new Date,a="",i=e.formatDate(n);switch(o){case 7:case 30:case 90:a=e.addDate(n,-1*o);break;default:a=e.addDate(n,-1)}t.setDateRange(a,i)})},initPagenation:function(){var e=this;e.pagination=(new m.Pagination).init({pageClickToTop:e.option.pageClickToTop}),e.dataloaded(function(t){e.pagination.generateByMap(t)}),e.pagination.pageclick(function(t){e.search(t.page)})},initCustomField:function(){for(var e=this.option.customField,t=e.length,n=0;t>n;n++)this[e[n]]=o.observable()},clearDateRange:function(){this.setDateRange("","")},setDateRange:function(e,t){var o=this.jqForm.find("[data-role='dateRange'] input[type='date']");console.log("DefaultViewController.setDateRange"),console.log(e),console.log(t),o.eq(0).val(e),o.eq(1).val(t)},setData:function(e){if(e)this.list(e);else try{this.list.removeAll()}catch(t){}},setCustomField:function(e){for(var t=this.option.customField,o=t.length,n="",a=0;o>a;a++)n=t[a],this[n](e[n])},getPage:function(){return e.tryParseInt(this.jqForm.find("[name='page']").val())},setPage:function(e){this.jqForm.find("[name='page']").val(e)},getRows:function(){return e.tryParseInt(this.jqForm.find("[name='rows']").val())},setRows:function(e){this.jqForm.find("[name='rows']").val(e)},search:function(t){var o=this,n=o.jqForm,a=null,i=t||1;this.setPage(i),a=m.serializeMap(n),this.option.useEndDatePlus===!0&&(a.e_date=e.addDate(a.e_date,1)),console.log(a),e.getJSON(o.jqForm.attr("action"),a,function(t){console.log("DefaultViewController.search"),console.log(t),o.setData(t[o.option.colList]),o.setCustomField(t),o.data=t,t.page=i,t.rows=o.getRows(),t.totalRowCount=e.tryParseInt(t[o.option.colTotalRowCount]),o.onDataLoaded(t)})},isVisible:function(){return this.jqView.hasClass("active-view")},show:function(){this.clearDateRange(),this.search(),m.viewSlider.left(this.jqView)},hide:function(){m.viewSlider.prev()}},m.CouponViewController=function(){},m.CouponViewController.prototype=new m.DefaultViewController,e.extend(m.CouponViewController.prototype,{constructor:m.CouponViewController,init:function(t){m.DefaultViewController.prototype.init.call(this,t);var o=this;return o.jqFormRegCoupon=e(o.option.formRegCoupon||"#form_regOfflineCoupon"),o.jqFormRegCoupon.submit(o.onSubmitRegCoupon),o.onSubmitRegCoupon=function(){var t=o.jqFormRegCoupon,n=t.serialize();return e.post(o.jqFormRegCoupon.attr("action"),n,function(e){var t=e;"1"===t?(alert("쿠폰 등록이 완료 되었습니다."),o.search(1)):"2"===t?(alert("쿠폰 적용이 완료 되어 온라인 쿠폰으로 교환 되었습니다."),o.search(1)):"99"===t?alert("로그인이 필요 합니다."):"noaddr"===t?alert("교환 상품에 도서가 포함된 경우 회원 정보란에 주소가 입력 되어있어야 합니다.\n\r상단 정보수정을 클릭하신후 주소를 입력하시고 쿠폰을 재사용 부탁드립니다."):"n"===t?alert("쿠폰번호가 틀렸거나 존재 하지 않는 쿠폰입니다."):"j"===t&&alert("이미 사용한 쿠폰입니다."),o.setCouponNo("")}),!1},o.jqFormRegCoupon.submit(o.onSubmitRegCoupon),this},setData:function(e){if(e){for(var t=e.length,o=0;t>o;o++)e[o].cp_period_edate=e[o].cp_period_edate.replace("<br>","");this.list(e)}else try{this.list.removeAll()}catch(n){}},setCouponNo:function(e){this.jqFormRegCoupon.find("[name='coupon_no']").val(e)}})});
window.m=window.m||{},define(["jquery","carousel","knockout","knockoututils","json2.min","bootstrap","owlcarousel","iscroll","sammy","mobilebase","navbar","order","myorder","contents","member","board","mypage","autocomplete","event"],function(e,t,a){function o(){var t=this;t.main={jqMain:e("#view_main"),jqAd:e("#owlca_ad"),jqBooks:e("#owlca_books"),event:new m.eventData,exam:a.observableArray(),notice:new m.bbsListData,news:new m.bbsListData,isMain:a.observable(!0),init:function(){""===m.web_param.view_type||"main"===m.web_param.view_type,t.main.jqAd.owlCarousel({autoPlay:3e3,items:1,itemsDesktop:[1199,1],itemsDesktopSmall:[979,1],itemsMobile:[479,1],itemsTablet:[768,1],afterMove:function(){}}),t.main.jqBooks.owlCarousel({autoPlay:4e3,items:6,itemsDesktop:[1199,6],itemsDesktopSmall:[980,5],itemsTablet:[768,4],itemsTabletSmall:[699,3],itemsMobile:[450,2]}),e("#owlca_books").siblings(".prev").click(function(){return t.main.jqBooks.data("owlCarousel").prev(),!1}),e("#owlca_books").siblings(".next").click(function(){return t.main.jqBooks.data("owlCarousel").next(),!1}),e(window).on("m.slidechanged",function(e,a){t.main.jqMain.get(0)===a.target?t.main.isMain(!0):t.main.isMain(!1)});try{e("#modal_popup .btn-popup-close-not-today").click(function(){m.cookie.set("popup_not_today","true",24,"m.sdedu.co.kr")}),e("*[data-close]").click(function(){e(e(this).data("close")).modal("hide")}),e("#modal_popup").get(0).addEventListener("touchmove",function(e){return e.preventDefault(),!1},!1)}catch(a){}e.getJSON("/mobile/mb/main.json",function(e){console.log(e),t.nav&&t.nav.setData(e.cate),t.main.setData(e);try{t.headline.init(),t.hideLoadingModal()}catch(a){}try{"main"!==m.web_param.view_type||"main"!==m.sammy.params.view_type&&"home"!==m.sammy.params.view_type||"true"===m.cookie.get("popup_not_today")||""!==m.web_param.cat_id||t.showPopup()}catch(a){console.log("팝업 띄우기 실패")}t.main.onMainDataLoaded(e)}).fail(function(){console.log("main.php 로딩에 실피 했습니다.")});var o=e("#button_footerNavCloser"),i=m.cookie.get("footerNav");o.click(function(){var t=e(this),a=e("#button_myMenuOpener, #button_gotoTop"),o=e(".footer-float-nav-margin");return a.hasClass("down")===!1?(a.animate({bottom:"-=55px"},function(){e(this).toggleClass("down"),o.css("height","0px")}),m.cookie.set("footerNav","close",24)):(a.animate({bottom:"+=55px"},function(){e(this).toggleClass("down"),o.css("height","66px")}),m.cookie.set("footerNav","open",24)),t.toggleClass("bg-f-nav-close"),t.toggleClass("bg-f-nav-open"),e(this).next().slideToggle(),!1}),"close"===i&&o.trigger("click")},setData:function(a){var o=t.main.jqAd.data("owlCarousel"),i="http://image.sdedu.co.kr";t.main.jqAd.empty(),e.map(a.bn,function(e){o.addItem(t.makeOwlcaItem(i+"/data/cm_shop/banner/"+e.bn_file,"#contents/lec/"+m.findBookCateByLecCate(e.lec_cat_id).book_cate+"/"+e.lec_cat_id+"/"+e.cat_name))}),o=t.main.jqBooks.data("owlCarousel"),t.main.jqBooks.empty(),e.map(a.best,function(e){var a=t.dcRate(e.it_price,e.it_sug_price);o.addItem(t.makeOwlcaItem(i+"/data/cm_shop/book/"+e.it_id+"/"+e.it_file_l,"#contents/book/"+e.it_id,"<br/><span><b>"+e.it_name+'<br/></b><br/><strong class="text-danger">&#8361;'+t.numberFormat(e.it_price)+"("+a+"%할인)</strong></span>"))}),t.main.event.set(a.event),t.main.exam.removeAll(),e.map(a.exam,function(e){t.main.exam.push(new m.examListData(e))}),t.main.notice.set(a.notice),t.main.news.set(a.news)},onBannerClick:function(a){var o=null,i=e(a.target);o="IMG"===i.prop("tagName")?i.parent():i.parentsUntil("a").parent();try{a.currentTarget=o.get(0),t.onClickBoard(t,a)}catch(a){}},evt_maindataloaded:null,maindataloaded:function(e){this.evt_maindataloaded=e},onMainDataLoaded:function(e){try{this.evt_maindataloaded(e)}catch(t){}}},t.headline={lecList:a.observableArray(),bookList:a.observableArray(),init:function(){try{t.main.headline=(new m.HeadlineRoller).init({list:"#headline_topLecture .roller",panel:"#headline_topLecture",requestURL:"/mobile/mb/ranking_cate.php"}),t.main.headline.dataloaded(function(e){t.headline.lecList(e.lec_cat),t.headline.bookList(e.book_cat)}),e("#headline_topLecture .btn-collapse").click(function(){t.headline.toggle()}),e(".wrap-headline-tab .btn-collapse-close").click(function(){t.headline.toggle()}),console.log("헤드라인 로드 완료!")}catch(a){console.log("오류있다능 조심하라능"),console.log(a)}},toggle:function(){t.main.headline.toggle(),e(".wrap-headline-tab").toggle()}},t.makeOwlcaItem=function(e,t,a){return'<div class="item"><a href="'+t+'"><img alt="" src="'+e+'"/>'+(void 0!==a?a:"")+"</a></div>"},t.getViewButton=function(t){var a=null;return a="movie"===t?e("#wrap_adViewButtons").find(".btn-movie").clone():e("#wrap_adViewButtons").find(".btn-book").clone(),e("<div/>").append(a).html()},t.main.init()}function i(e,t){console.log("setMbdata---"+e);var o=new m.MVModel;o.mname=a.observable(e),o.mid=a.observable(t)}function n(){this.run=function(){if(void 0===m.NavModel||void 0===m.OrderModel||void 0===m.MyOrderModel||void 0===m.BoardModel||void 0===m.MemberModel||void 0===m.MyPageModel||void 0===m.ContentsModel||void 0===m.AutoCompleteModel)throw"some models are undefined.";if(m.binded!==!0){var t=new m.MVModel,o=new m.NavModel,i=new m.OrderModel,n=new m.MyOrderModel,r=new m.BoardModel,s=new m.MemberModel,l=new m.MyPageModel,c=new m.ContentsModel,d=new m.AutoCompleteModel;e.extend(t,o),e.extend(t,i),e.extend(t,n),e.extend(t,r),e.extend(t,s),e.extend(t,l),e.extend(t,c),e.extend(t,d),t.main.maindataloaded(function(a){if(""!==m.web_param.cat_id){var o={},i=a.cate,n=null,r=null,s=null,l=m.web_param.cat_id,c=!1,d=0,b=null;if(o.view_type="contents",o.name="all","0"===m.web_param.it_type)for(var u in i){n=i[u].sub_cat;for(var p in n){r=n[p],s=r.sub_cat,d=s.length;for(var h=0;d>h;h++)if(s[h].cat_id===l){o.bbsId=l,o.subId=m.lecCateInfo.hasOwnProperty(l)?m.lecCateInfo[l].lec_cate:"",o.keyword=s[h].cat_name,c=!0;break}}if(c===!0)break}else"1"===m.web_param.it_type&&(b=m.findBookCateByLecCate(m.web_param.cat_id),o.bbsId=b.book_cate,o.subId=b.lec_cate,o.keyword=b.name);t.doClickBoard(o),m.viewSlider.push(e("#view_main"))}}),t.contents.submitorder(function(e,a){var o=t.member.hasLogin(),a=void 0===a?!1:a;o===!0?a===!0?location.href="#order/cartlist"+(a===!0?"/buy":""):confirm("상품이 장바구니에 담겼습니다.\r\n지금 바로 확인하시겠습니까?")===!0&&(location.href="#order/cartlist"+(a===!0?"/buy":"")):(location.href="#member/login"+(a===!0?"/buy":""),m.viewSlider.push(param))}),t.contents.submitorderfree(function(e){var a=t.member.hasLogin();"YES"===e.status[0].status&&a===!0?confirm("무료수강 신청이 완료 되었습니다.\r\n마이페이지로 이동하시겠습니까?")===!0&&(location.href="#mypage/mylec"):location.href="#member/login"}),t.contents.searchtextfocus(function(a){""===e(a.currentTarget).val()?t.lastsearch.isVisible()===!1&&t.lastsearch.show():t.autocomplete.isVisible()===!1&&t.autocomplete.show(),setTimeout(function(){window.scrollTo(0,0)},1500)}),t.contents.submitsearch(function(e){t.lastsearch.put(e),t.lastsearch.hide()}),t.lastsearch.shown(function(){t.autocomplete.hide(),e(".navbar").removeClass("navbar-fixed-top").css({position:"relative",top:0,right:0,left:0,border:"none"}),e(".container-first").hide(),e(".aside, .footer-float-nav").hide()}),t.lastsearch.shown(function(){t.autocomplete.hide(),e(".navbar").removeClass("navbar-fixed-top").css({position:"relative",top:0,right:0,left:0,border:"none"}),e(".container-first").hide(),e(".aside, .footer-float-nav").hide()}),t.lastsearch.hidden(function(){t.autocomplete.isVisible()===!1&&(e(".navbar").addClass("navbar-fixed-top").css({position:"fixed"}),e(".container-first").show()),t.lastsearch.isVisible()===!1&&t.autocomplete.isVisible()===!1&&e(".aside, .footer-float-nav").show()}),t.autocomplete.hidden(function(){t.lastsearch.isVisible()===!1&&(e(".navbar").addClass("navbar-fixed-top").css({position:"fixed"}),e(".container-first").show()),t.lastsearch.isVisible()===!1&&t.autocomplete.isVisible()===!1&&e(".aside, .footer-float-nav").show()}),e("input[type='text'], input[type='password'], input[type='number'], input[type='date'], textarea").focus(function(){e(".aside, .footer-float-nav").hide()}).focusout(function(){t.lastsearch.isVisible()===!1&&t.autocomplete.isVisible()===!1&&e(".aside, .footer-float-nav").show()}),t.member.loginsuccess(function(a,o){t.order.member.mb_id(a.mb_id),"main"===o.toOtherView&&t.doClickBoard({view_type:""}),e(".aside, .footer-float-nav").show()}),t.member.logoutsuccess(function(){t.order.member.mb_id(""),m._cpiClicked=!1,location.href="#main"}),t.board.logincheck(function(){var e=t.member.hasLogin();return console.log("vm.board.logincheck:: 진행중::"+e),e}),t.comment.logincheck(function(){var e=t.member.hasLogin();return e===!1&&confirm("덧글을 남기기 위해서는 로그인이 필요합니다.\r\n로그인 하시겠습니까?")===!0&&(location.href="#member/login"),e}),t.memUpdate.logincheck(function(){var e=t.member.hasLogin();return e}),t.board.levelcheck(function(){var e=t.member.mb_level();return e}),t.board.authcheck(function(e,a){var o=!1;return o=void 0!==e.bbsId?t.member.mb_level()>=a.auth.detail:t.member.mb_level()>=a.auth.list,console.log(e),console.log(o),o===!0?!1:(t.member.moveViewByParam({view_type:"member",name:"login",bbsId:""}),m.viewSlider.push(e),!0)}),t.order.infoshown(function(){e.post("/mobile/mb/mem_chk.php",{mb_id:t.member.mb_id()},function(){})}),t.coupon.dataloaded(function(){}),t.zipcode.selected(function(e){t.order.isVisible()===!0&&(t.order.member.mb_zip1(e.zip1),t.order.member.mb_zip2(e.zip2),t.order.member.mb_addr1(e.addr),t.order.member.mb_addr2(""))}),t.zipcode.selected(function(e){t.memUpdate.isVisible()===!0&&(t.memUpdate.mb_zip1(e.zip1),t.memUpdate.mb_zip2(e.zip2),t.memUpdate.mb_addr1(e.addr),t.memUpdate.mb_addr2(""))});var b=function(a){if(m._cpiClicked=m._cpiClicked||!1,console.log("index.fnOnURIChange"),m._cpiClicked!==!0){if(m._cpiClicked=!0,setTimeout(function(){m._cpiClicked=!1},500),t.autocomplete.hide(),t.lastsearch.hide(),"board"!==a.view_type&&"g4_write_cs_faq"!==a.name&&e(window).scrollTop(0),"board"===a.view_type)console.log("보드!"),t.board.searchByParam(a);else if("contents"===a.view_type)t.contents.searchByParam(a);else if("member"===a.view_type)t.member.moveViewByParam(a);else if("order"===a.view_type)"mocklist"===a.name?alert("준비중 입니다."):t.member.hasLogin()===!1?(t.member.moveViewByParam({view_type:"member",name:"login"}),m.viewSlider.push(a)):"cartlist"===a.name?t.order.load(void 0,function(){"buy"===a.bbsId?t.order.show(!0):t.order.show()}):"booklist"===a.name?t.myBooks.show():"list"===a.name&&t.myOrder.show();else{if("nav"===a.view_type)return t.nav.showNavByParam(a),void 0;"mypage"===a.view_type?"regbook"===a.name?alert("준비중 입니다."):t.member.hasLogin()===!1?(t.member.moveViewByParam({view_type:"member",name:"login"}),m.viewSlider.push(a)):"mylec"===a.name?t.myLecture.showByParam(a):"coupon"===a.name?t.coupon.show():"mileage"===a.name?t.mileage.show():"regbook"===a.name&&alert("준비중 입니다."):"doc"===a.view_type?e.get("/mobile/doc/"+a.name+".php",function(t){var o=e("#view_doc");o.find("h2>span").text(a.bbsId),o.find(".article").html(t),m.viewSlider.left(o)}):"main"===a.view_type?(m._cpiClicked=!1,console.log("cpi 초기화"),m.viewSlider.left("#view_main")):"gotoback"===a.view_type?(m.viewSlider.prev(),console.log("뒤로가기")):(m._cpiClicked=!1,console.log("cpi 초기화"),m.viewSlider.left("#view_main"))}t.nav.hideMyMenu(),t.nav.hide()}};m.sammy.urichange(b),e("#view_lectureContent").on("m.slidechanged",function(){}),e("#view_boardList").on("m.slidechanged",function(){}),e(".view_bookDetail").on("m.slidechanged",function(){var t=e("#panel_productInfo1").find("a"),a=e("#panel_productInfo1 table").filter(function(){var t=e(this),a=e.tryParseInt(t.attr("width"));return a>400&&700>a?!0:void 0});t.parentsUntil("div").empty(),a.css({width:"100%"})}),e("#view_boardDetail").on("m.slidechanged",function(){var a=t.board.heading.type();if("event"===a){var o=e("#view_boardDetail").find(".wrap-wr-content img");console.log(o),o.css({width:"100%",height:"auto"}),m.event.init()}}),e("#view_boardDetail").on("m.sameslidefound",function(){var a=t.board.heading.type();if("event"===a){var o=e("#view_boardDetail").find(".wrap-wr-content img");console.log(o),o.css({width:"100%",height:"auto"}),m.event.init()}}),m.vm=t,e(".heading-contents").append(e('<a href="#" class="_gotoback"></a>').click(function(){m.viewSlider.prev()})),a.applyBindings(t),m.binded=!0,"main"!==m.web_param.view_type?(m.vm.doClickBoard(m.web_param),m.viewSlider.push(e("#view_main"))):""!==m.web_param.cat_id}}}o.prototype=new m.BaseViewModel,o.prototype.constructor=o,m.MVModel=o,m.setMBdata=i,m.bannerDataKeys=["bn_cnt","bn_file","bn_sort","bn_subject","bn_type","bn_url","cat_id"],m.bannerData=function(e){var t=this,o=m.bannerDataKeys.length,i=m.bannerDataKeys;if(e)for(var n=0;o>n;n++)t[i[n]]=a.observable(e[i[n]]);else for(var n=0;o>n;n++)t[i[n]]=a.observable("");t.set=function(e){if(e)for(var a=0;o>a;a++)t[i[a]](e[i[a]]);else for(var a=0;o>a;a++)t[i[a]]("")}},m.bookDataKeys=["cat_id","it_file_l","it_id","it_name","it_price","it_sug_price"],m.bookData=function(e){var t=this,o=m.bookDataKeys.length,i=m.bookDataKeys;if(e)for(var n=0;o>n;n++)t[i[n]]=a.observable(e[i[n]]);else for(var n=0;o>n;n++)t[i[n]]=a.observable("");t.set=function(e){if(e)for(var a=0;o>a;a++)t[i[a]](e[i[a]]);else for(var a=0;o>a;a++)t[i[a]]("")},t.getDcRate=function(){return 0}},m.eventDataKeys=["wr_subject","bf_file","wr_id"],m.eventData=function(e){var t=this,o=m.eventDataKeys.length,i=m.eventDataKeys;if(t.bf_file_path="/data/file/event/",e)t.wr_subject=a.observable(e.wr_subject),t.bf_file=a.observable(t.bf_file_path+e.bf_file),t.wr_id=a.observable(e.wr_id);else{for(var n=0;o>n;n++)t[i[n]]=a.observable("");t.bf_file(m.img.none)}t.set=function(e){if(e)t.wr_subject(e.wr_subject),t.bf_file(t.bf_file_path+e.bf_file),t.wr_id(e.wr_id);else{for(var a=0;o>a;a++)t[i[a]]("");t.bf_file(m.img.none)}}},m.bbsListDataKeys=["wr_subject","wr_id"],m.bbsListData=function(e){var t=this,o=m.bbsListDataKeys.length,i=m.bbsListDataKeys;if(e)for(var n=0;o>n;n++)t[i[n]]=a.observable(e[i[n]]);else for(var n=0;o>n;n++)t[i[n]]=a.observable("");t.set=function(e){if(e)for(var a=0;o>a;a++)t[i[a]](e[i[a]]);else for(var a=0;o>a;a++)t[i[a]]("")}},m.examListDataKeys=["ES_wrsdate","wr_subject","wr_id"],m.examListData=function(e){var t=this,o=m.examListDataKeys.length,i=m.examListDataKeys;if(e)for(var n="",r=0;o>r;r++)n=i[r],t[n]="ES_wrsdate"===n?a.observable(e[n].replace("-",".")):a.observable(e[n]);else for(var r=0;o>r;r++)t[i[r]]=a.observable("");t.set=function(e){var a="";if(e)for(var n=0;o>n;n++)"ES_wrsdate"===a?t[i[n]](e[i[n]].replace("-",".")):t[i[n]](e[i[n]]);else for(var n=0;o>n;n++)t[i[n]]("")}},m.HeadlineRoller=function(){this.stopped=a.observable(!1),this.list=a.observableArray(),this.jqList=null,this.jqPanel=null,this.currIndex=0,this.lastIndex=0},m.HeadlineRoller.prototype={init:function(t){var a={max:10,list:null,panel:null,stopDelay:3e3,aniDelay:1e3,autoStart:!0,height:26};return e.extend(a,t),this.checkRequireOption(a,this._getRequireOptionNames()),this.option=a,this.max=this.option.max,this.jqList=e(this.option.list),this.jqPanel=e(this.option.panel),this.jqList.css({position:"relative",overflow:"hidden"}),this.option.height=this.option.height||this.jqList.children().eq(0).height(),this.initEvent(),this.load(),this},checkRequireOption:function(e,t){for(var a=t.length,o="",i=void 0,n=0;a>n;n++)if(o=t[n],i=e[o],null===i||void 0===i)throw"HeadlineRoller.checkRequireOption: 오류: "+o+" 옵션은 필수 입니다."},animate:function(){var t=this.option.height,a=this.option.aniDelay,o=this.option.stopDelay,i=this.jqList,n=this;i.children().delay(o).each(function(o){o===n.max-1?e(this).animate({top:"-="+t+"px"},a,function(){i.children().eq(n.currIndex).css({top:(n.max-1)*t+"px"}),n.currIndex++,n.lastIndex++,n.currIndex>=n.max&&(n.currIndex=0),n.lastIndex>=n.max&&(n.lastIndex=0),n.stopped()===!1&&n.animate()}):e(this).animate({top:"-="+t+"px"},a)})},start:function(){this.animate()},stop:function(){this.stopped(!1)},toggle:function(){this.jqPanel.toggle()},_getRequireOptionNames:function(){return["list","panel"]},initEvent:function(){this.evt_dataloaded=null,this.dataloaded=function(e){this.evt_dataloaded=e},this.onDataLoaded=function(e){try{this.evt_dataloaded(e)}catch(t){}}},load:function(){var t=this;e.getJSON(this.option.requestURL,{rows:this.option.max},function(a){try{console.log(a);var o=(a.lec_cat.length,null),i=null,n="";e.each(a.lec_cat,function(e){o=a.lec_cat[e],n=o.cat_id,o.lec_cat_id=n,o.cat_id=m.findBookCateByLecCate(n).book_cate,o.nth=e+1,o.cat_name_enc=o.cat_name.replace(/\//g,"%2F")}),e.each(a.book_cat,function(e){i=a.book_cat[e],i.cat_name_enc=i.cat_name.replace(/\//g,"%2F")}),t.onDataLoaded(a),t.setList(a.lec_cat),t.option.autoStart===!0&&t.start()}catch(r){console.log(r),console.log("헤드라인 데이터 로딩 오류")}}).fail(function(e){console.log(e)}),this.option.autoStart===!0&&this.start()},clear:function(){try{this.list.removeAll()}catch(e){}},setList:function(t){var a=t.length,o=this;this.clear();for(var i=0;a>i;i++)t[i].nth=i+1;this.list(t),this.currIndex=0,this.lastIndex=a-1,this.max=a,this.jqList.children().each(function(t){e(this).css({position:"absolute",top:t*o.option.height+"px"})})}},m.App=n,e(function(e){var t=new e.App;t.run()}(window.m,e,a))});
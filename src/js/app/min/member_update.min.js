window.m=window.m||{},define(["jquery","knockout","knockoututils","json2.min","bootstrap","jqueryfinger","mobilebase"],function(e,a){function t(){var t=this;t.memUpdate={hp0:a.observable(0),hp1:a.observable(0),hp2:a.observable(0),mb_id:a.observable(""),mb_name:a.observable(""),mb_email:a.observable(""),mb_hp:a.observable(""),mb_sms:a.observable(!1),mb_mailling:a.observable(!1),mb_fav:a.observable(""),mb_zip1:a.observable(0),mb_zip2:a.observable(0),mb_addr1:a.observable(""),mb_addr2:a.observable(""),sms_msg:a.observable(""),modal_msg:a.observable(""),agreenum:a.observable(0),buttonChk:a.observable(0),myAgreechk:a.observable(0),jqFormCheck:e("#member_check_form"),jqFormUpdate:e("#member_update_form"),init:function(){e(".cate-title a").addClass("collapsed"),e("[name='b1']").click(function(){var m=e(":radio[name='b1']:checked").val();e("[name='memfav']").val(m)}),e("[name='mb_email']").on("keyup",function(){for(i=0;i<e("[name='mb_email']").val().length;i++){var m=e("[name='mb_email']").val().charCodeAt(i);if(m>=128)return alert("영문과 숫자만 입력 가능합니다"),e("[name='mb_email']").val(""),e("[name='mb_email']").focus(),!1}}),this.jqFormCheck.submit(this.onCheckSumit),this.jqFormUpdate.submit(this.onUpdateSumit),this.getMemberInfo()},getMemberInfo:function(){e.getJSON("/mobile/mb/member_info.php",{mb_id:m.mb_id},function(m){if(console.log(m),t.memUpdate.mb_id(m[0].mb_id),t.memUpdate.mb_name(m[0].mb_name),t.memUpdate.mb_email(m[0].mb_email),t.memUpdate.mb_zip1(m[0].mb_zip1),t.memUpdate.mb_zip2(m[0].mb_zip2),t.memUpdate.mb_addr1(m[0].mb_addr1),t.memUpdate.mb_addr2(m[0].mb_addr2),"1"===m[0].mb_sms&&t.memUpdate.mb_sms(!0),"1"===m[0].mb_mailling&&t.memUpdate.mb_mailling(!0),m[0].mb_hp){var a=m[0].mb_hp.split("-");t.memUpdate.hp0(a[0]),t.memUpdate.hp1(a[1]),t.memUpdate.hp2(a[2])}null!==m[0].fav&&e("[name='b1']").each(function(a){e("[name='b1']").eq(a).val()===m[0].fav&&(e("[name='b1']").eq(a).prop("checked",!0),e("[name='memfav']").val(m[0].fav))})})},changePhoneNum:function(){var m=confirm("휴대폰 번호를 변경하시려면 인증 절차를 거쳐야 합니다.");m&&(e("#pAgreeButton").show(),e("#pAgreeArea").show(),e("#pChangeButton").hide(),e("[name='mb_hp0']").prop("readonly",!1),e("[name='mb_hp1']").prop("readonly",!1),e("[name='mb_hp2']").prop("readonly",!1),t.memUpdate.myAgreechk(9))},getAgreeNum:function(){var m=t.memUpdate.buttonChk(),a=m+1,o=e("[name = 'mb_name']").val(),r=e("[name = 'mb_hp0']").val(),p=e("[name = 'mb_hp1']").val(),s=e("[name = 'mb_hp2']").val(),d="alone",n="회원";return r||p||s?r&&p&&s?a>3?(t.memUpdate.modal_msg("인증번호를 3회 이상 받을수 없습니다. 다시 진행해주세요."),t.memUpdate.showModalMessage(),!1):(t.memUpdate.buttonChk(a),e.getJSON("/mobile/mb/getAgreeNumber.php",{hp0:r,hp1:p,hp2:s,mode:d,mb_name:o},function(e){t.memUpdate.sms_msg(e.status.msg),t.memUpdate.agreenum(e.status.status),t.memUpdate.modal_msg(t.memUpdate.sms_msg()),t.memUpdate.showModalMessage()}),o="",r="",p="",s="",d="",n="",t.memUpdate.modal_msg(""),void 0):(t.memUpdate.modal_msg("휴대폰 번호를 올바르게 입력해주세요."),t.memUpdate.showModalMessage(),!1):(t.memUpdate.modal_msg("휴대폰 번호를 입력해주세요."),t.memUpdate.showModalMessage(),!1)},chkAgreeNum:function(){t.memUpdate.modal_msg("");var m=t.memUpdate.agreenum(),a=e("[name='mb_agrere_num']").val();return 0==m?(t.memUpdate.modal_msg("인증번호를 전송받지 못하였습니다."),t.memUpdate.showModalMessage(),!1):a?m!=a?(t.memUpdate.modal_msg("인증번호가 정확하지 않습니다."),t.memUpdate.showModalMessage(),!1):(m==a&&(t.memUpdate.modal_msg("인증에 성공하였습니다."),t.memUpdate.agreenum(0),t.memUpdate.showModalMessage(),e("#pAgreeButton").hide(),e("#pAgreeArea").hide(),e("[name='mb_hp0']").prop("readonly",!0),e("[name='mb_hp1']").prop("readonly",!0),e("[name='mb_hp2']").prop("readonly",!0),t.memUpdate.myAgreechk(1),t.memUpdate.showModalMessage(),e("[name='check_phone']").val("ok")),void 0):(t.memUpdate.modal_msg("인증번호를 입력해주세요."),t.memUpdate.showModalMessage(),!1)},showUpdateStep2:function(){m.viewSlider.left("#view_memberUpdateStep2"),t.memUpdate.includeRecaptcha()},showUpdateStep3:function(){m.viewSlider.left("#view_memberUpdateStep3")},mbUpdatePrev:function(){m.viewSlider.prev()},showModalMessage:function(){e("#systemMessage").modal("show")},memUpdateCompleted:function(){t.memUpdate.jqFormUpdate.submit()},memCheckCompleted:function(){t.memUpdate.jqFormCheck.submit()},onCheckSumit:function(){var a=m.serializeMap(t.memUpdate.jqFormCheck);return e.post(t.memUpdate.jqFormCheck.attr("action"),a,function(m){try{var a=e.parseJSON(m);1===a.status.status?t.memUpdate.showUpdateStep2():(2===a.status.status?t.memUpdate.modal_msg("회원 정보에 문제가 있습니다."):9===a.status.status&&t.memUpdate.modal_msg("아이디와 비밀번호가 일치하지 않습니다."),t.memUpdate.showModalMessage())}catch(o){console.log(o),console.log(m),alert("error")}}),!1},onUpdateSumit:function(){var a=m.serializeMap(t.memUpdate.jqFormUpdate),o=t.memUpdate.myAgreechk();if(a.mb_password){if(a.mb_password!=a.mb_password_chk)return alert("패스워가 일치하지 않습니다."),!1;if(a.mb_password.length<6||a.mb_password.length>12)return alert("비밀번호는 6~12자의 영문, 숫자, 특수문자만 가능합니다"),!1;if(a.mb_password_chk.length<6||a.mb_password_chk.length>12)return alert("비밀번호는 6~12자의 영문, 숫자, 특수문자만 가능합니다"),!1;if(!a.mb_password_chk)return alert("패스워드를 확인해주세요."),!1}9===o&&alert("휴대폰 번호 변경을 원하였으나 미인증 되었습니다.\n\r기존 휴대폰 번호로 유지됩니다.");var r=confirm("현재 작성하신 내용으로 수정 하시겠습니까?");return r?(e.post(t.memUpdate.jqFormUpdate.attr("action"),a,function(m){try{var a=e.parseJSON(m);a&&(console.log(a),t.memUpdate.showUpdateStep3())}catch(o){console.log(o),console.log(m),alert("error")}}),!1):!1},includeRecaptcha:function(){var m=e("#recaptcha_update");0===m.children().length&&require(["recaptcha"],function(){window.Recaptcha.create("6LdlfPgSAAAAAPtMMtOIblkvZBEPS7nnMROEhTWJ","recaptcha_update",{theme:"white"})})},isVisible:function(){return e("#view_memberUpdateStep2").hasClass("active-view")}},t.memUpdate.init()}t.prototype=new m.BaseViewModel,t.prototype.constructor=t,m.MemberUpdate=t});